
<div class="row g-4">
  <div class="col-xl-4">
    <div class="card card-glass h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h5 section-title mb-0">Rutinas</h2>
          <button class="btn btn-outline-primary btn-sm" (click)="cargarRutinas()">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>
        <form [formGroup]="rutinaForm" (ngSubmit)="guardarRutina()" class="d-grid gap-3">
          <div>
            <input class="form-control" placeholder="Cédula entrenador" formControlName="entrenadorCedula">
            <small class="text-secondary">Debe corresponder a un entrenador registrado.</small>
          </div>
          <input class="form-control" placeholder="Nombre de la rutina" formControlName="nombre">
          <input class="form-control" placeholder="Objetivo (p. ej. Hipertrofia)" formControlName="objetivo">
          <div>
            <input class="form-control" type="number" placeholder="Duración (semanas)" formControlName="duracionSemanas">
            <small class="text-secondary">Usa números positivos.</small>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-gradient flex-grow-1" type="submit" [disabled]="saving">
              {{ saving ? 'Guardando...' : (editRutina ? 'Actualizar rutina' : 'Crear rutina') }}
            </button>
            <button *ngIf="editRutina" class="btn btn-outline-secondary" type="button" (click)="cancelarEdicionRutina()">Cancelar</button>
          </div>
        </form>
        <hr class="my-4">
        <div *ngIf="loadingRutinas" class="text-center py-3">
          <div class="spinner-border text-primary" role="status"></div>
        </div>
        <div class="list-group gap-2" *ngIf="!loadingRutinas">
          <a
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start flex-column"
            *ngFor="let rutina of rutinas"
            (click)="seleccionarRutina(rutina)"
            [class.active]="selectedRutina?.id === rutina.id">
            <div class="w-100 d-flex justify-content-between align-items-start">
              <div>
                <span class="fw-semibold">{{ rutina.nombre }}</span>
                <div class="small text-secondary">{{ rutina.objetivo }} · {{ rutina.duracionSemanas }} semanas</div>
              </div>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" type="button" (click)="$event.stopPropagation(); editarRutina(rutina)"><i class="bi bi-pencil-square"></i></button>
                <button class="btn btn-outline-danger" type="button" (click)="$event.stopPropagation(); eliminarRutina(rutina)"><i class="bi bi-trash"></i></button>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-4" *ngIf="selectedRutina">
    <div class="card card-glass h-100">
      <div class="card-body">
        <h2 class="h5 section-title mb-3">Planes de {{ selectedRutina.nombre }}</h2>
        <form [formGroup]="planForm" (ngSubmit)="guardarPlan()" class="d-grid gap-3">
          <input class="form-control" placeholder="Nombre plan" formControlName="nombre">
          <textarea class="form-control" rows="2" placeholder="Descripción" formControlName="descripcion"></textarea>
          <div class="row g-3">
            <div class="col-md-4">
              <input type="number" class="form-control" placeholder="Duración (días)" formControlName="duracionDias">
            </div>
            <div class="col-md-4">
              <input type="date" class="form-control" formControlName="fechaInicio">
            </div>
            <div class="col-md-4">
              <input type="date" class="form-control" formControlName="fechaFin">
            </div>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-primary flex-grow-1" type="submit" [disabled]="saving">
              {{ saving ? 'Guardando...' : (editPlan ? 'Actualizar plan' : 'Agregar plan') }}
            </button>
            <button *ngIf="editPlan" class="btn btn-outline-secondary" type="button" (click)="cancelarEdicionPlan()">Cancelar</button>
          </div>
        </form>
        <hr class="my-4">
        <div *ngIf="loadingPlanes" class="text-center py-3">
          <div class="spinner-border text-primary" role="status"></div>
        </div>
        <div class="list-group gap-2" *ngIf="!loadingPlanes">
          <a
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start flex-column"
            *ngFor="let plan of planes"
            (click)="seleccionarPlan(plan)"
            [class.active]="selectedPlan?.id === plan.id">
            <div class="w-100 d-flex justify-content-between align-items-start">
              <div>
                <span class="fw-semibold">{{ plan.nombre }}</span>
                <div class="small text-secondary">{{ plan.descripcion }}</div>
              </div>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" type="button" (click)="$event.stopPropagation(); editarPlan(plan)"><i class="bi bi-pencil-square"></i></button>
                <button class="btn btn-outline-danger" type="button" (click)="$event.stopPropagation(); eliminarPlan(plan)"><i class="bi bi-trash"></i></button>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-4" *ngIf="selectedPlan">
    <div class="card card-glass h-100">
      <div class="card-body">
        <h2 class="h5 section-title mb-3">Alimentos del plan</h2>
        <form [formGroup]="alimentoForm" (ngSubmit)="agregarAlimento()" class="d-grid gap-3">
          <div>
            <input class="form-control" type="number" placeholder="ID alimento" formControlName="alimentoId">
            <small class="text-secondary">Ingresa el ID existente en el catálogo de alimentos.</small>
          </div>
          <input class="form-control" placeholder="Cantidad (p. ej. 150g)" formControlName="cantidad">
          <select class="form-select" formControlName="comidaDelDia">
            <option value="" disabled>Comida del día</option>
            <option *ngFor="let comida of comidas" [value]="comida">{{ comida }}</option>
          </select>
          <button class="btn btn-outline-success" type="submit" [disabled]="saving">Asignar alimento</button>
        </form>
        <hr class="my-4">
        <div *ngIf="loadingAlimentos" class="text-center py-3">
          <div class="spinner-border text-primary" role="status"></div>
        </div>
        <div class="list-group gap-2" *ngIf="!loadingAlimentos">
          <div class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let alimento of alimentos">
            <div>
              <div class="fw-semibold">Alimento ID {{ alimento.alimentoId }}</div>
              <small class="text-secondary">{{ alimento.cantidad }} · {{ alimento.comidaDelDia }}</small>
            </div>
            <button class="btn btn-link text-danger p-0" (click)="eliminarAlimento(alimento)"><i class="bi bi-trash"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="alert alert-success mt-3" *ngIf="mensajeExito">{{ mensajeExito }}</div>
<div class="alert alert-danger mt-3" *ngIf="error">{{ error }}</div>
